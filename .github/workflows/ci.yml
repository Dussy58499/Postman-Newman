name: Run Newman Tests

on: [push, pull_request]

jobs:
  newman-tests:
    runs-on: ubuntu-latest

    steps:
      
name: Checkout Repository
      uses: actions/checkout@v4

      
name: Install Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 18

      
name: Install Dependencies
      run: npm ci  # ci is better for CI/CD environments

      
name: Install Newman and Allure Reporter
      run: npm install -g newman newman-reporter-allure

      
name: Run Postman Collection
      run: |
        newman run Petstore.postman_collection.json \-r cli,html,allure \--reporter-html-export newman-report.html
      continue-on-error: true  # Allow workflow to continue if tests fail

      
name: Generate Allure Report
      run: |
        npm install -g allure-commandline
        allure generate allure-results --clean -o allure-report
      continue-on-error: true  # Allow workflow to continue if report generation fails

      
name: Deploy Allure Report to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        personal_token: ${{ secrets.TOKEN }}
        branch: report
        folder: allure-report
      continue-on-error: true  # Allow workflow to continue if deployment fails

      
name: Commit and Push HTML Report
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git checkout -B report
        mv newman-report.html allure-report/
        cd allure-report
        git add .
        git commit -m "Update Newman test report"
        git push --force origin report
      continue-on-error: true  # Allow workflow to continue even if this step fails